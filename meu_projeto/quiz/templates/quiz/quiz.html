<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quiz - Teoria do Judô</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            judo: {
              emerald: '#10B981',
              gray: '#6B7280',
              blue: '#3B82F6',
              yellow: '#FBBF24',
              orange: '#F97316',
              green: '#10B981',
              purple: '#8B5CF6',
              brown: '#92400E'
            }
          },
          fontFamily: {
            'display': ['Inter', 'system-ui', 'sans-serif'],
          }
        }
      }
    }
  </script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
    
    .gradient-bg {
      background: linear-gradient(135deg, #1E40AF 0%, #1D4ED8 100%);
    }
    
    .card-hover {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .card-hover:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 40px -12px rgba(30,64,175,0.25);
    }
    
    .fade-in {
      animation: fadeIn 0.6s ease-out;
    }
    
    @keyframes fadeIn {
      from { 
        opacity: 0; 
        transform: translateY(20px); 
      }
      to { 
        opacity: 1; 
        transform: translateY(0); 
      }
    }
    
    .slide-in {
      animation: slideIn 0.5s ease-out;
    }
    
    @keyframes slideIn {
      from { 
        opacity: 0; 
        transform: translateX(-30px); 
      }
      to { 
        opacity: 1; 
        transform: translateX(0); 
      }
    }
    
    .bounce-in {
      animation: bounceIn 0.8s ease-out;
    }
    
    @keyframes bounceIn {
      0% { 
        opacity: 0; 
        transform: scale(0.3); 
      }
      50% { 
        opacity: 1; 
        transform: scale(1.05); 
      }
      70% { 
        transform: scale(0.9); 
      }
      100% { 
        opacity: 1; 
        transform: scale(1); 
      }
    }
    
    .progress-bar {
      transition: width 0.8s ease-in-out;
    }
    
    .answer-btn {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .answer-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px -5px rgba(30,64,175,0.2);
    }
    
    .correct-answer {
      animation: correctPulse 0.6s ease-out;
    }
    
    @keyframes correctPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .incorrect-answer {
      animation: incorrectShake 0.6s ease-out;
    }
    
    @keyframes incorrectShake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
    
    .text-gradient {
      background: linear-gradient(45deg, #1E40AF, #1D4ED8);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .section-divider {
      background: linear-gradient(90deg, transparent, #DBEAFE, transparent);
    }
    
    /* Melhorias de responsividade para mobile */
    @media (max-width: 640px) {
      .answer-btn {
        padding: 0.75rem 1rem;
        font-size: 0.875rem;
      }
      
      .card-hover {
        padding: 1rem;
      }
      
      .card-hover h2 {
        font-size: 1.25rem;
        line-height: 1.4;
      }
    }
    
    /* Estilos para feedback visual */
    .answer-correct {
      background-color: #10B981 !important;
      color: white !important;
      border-color: #10B981 !important;
      animation: correctPulse 0.6s ease-out;
    }
    
    .answer-incorrect {
      background-color: #EF4444 !important;
      color: white !important;
      border-color: #EF4444 !important;
      animation: incorrectShake 0.6s ease-out;
    }
    
    .answer-show-correct {
      background-color: #10B981 !important;
      color: white !important;
      border-color: #10B981 !important;
    }
    
    @keyframes correctPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    @keyframes incorrectShake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }
  </style>
</head>
<body class="bg-gray-50 font-display min-h-screen">
    <!-- CSRF Token para requisições AJAX -->
    {% csrf_token %}
  <!-- Header com Progresso responsivo -->
  <header class="gradient-bg text-white py-4 sm:py-6 px-4">
    <div class="max-w-4xl mx-auto">
      <div class="flex items-center justify-between mb-4 sm:mb-6">
        <div class="flex-1">
          <h1 class="text-xl sm:text-2xl md:text-3xl lg:text-4xl font-bold mb-1 sm:mb-2 flex items-center gap-2 sm:gap-3">
            <i class="fa-solid fa-medal text-blue-300 text-lg sm:text-xl md:text-2xl"></i>
            <span class="text-white">Quiz - Teoria do Judô</span>
          </h1>
          <p class="text-blue-100 text-sm sm:text-base md:text-lg">Teste seus conhecimentos sobre a arte suave</p>
        </div>
        <a href="/index/" class="bg-white/20 hover:bg-white/30 px-3 py-2 sm:px-4 sm:py-2 rounded-lg transition-colors text-sm sm:text-base ml-2">
          <i class="fa-solid fa-arrow-left mr-1 sm:mr-2"></i>
          <span class="hidden sm:inline">Voltar</span>
        </a>
      </div>
      
      <!-- Barra de Progresso responsiva -->
      <div class="bg-white/20 rounded-full h-3 sm:h-4 mb-2 sm:mb-3 shadow-inner">
        <div class="progress-bar bg-gradient-to-r from-green-400 to-green-600 rounded-full h-3 sm:h-4 shadow-lg" 
             style="width: 0%" id="progressBar"></div>
      </div>
      
      <!-- Status responsivo -->
      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-2 sm:gap-0">
        <div class="flex flex-col sm:flex-row items-start sm:items-center gap-2 sm:gap-6">
          <span id="status" class="text-sm sm:text-base md:text-lg font-semibold">
            <i class="fa-solid fa-question-circle mr-1 sm:mr-2"></i>Pergunta 0/0
          </span>
          <span id="score" class="text-sm sm:text-base md:text-lg font-semibold text-blue-200">
            <i class="fa-solid fa-trophy mr-1 sm:mr-2"></i>Acertos: 0
          </span>
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-4xl mx-auto px-4 py-4 sm:py-6 md:py-8">
    <!-- Tela de Seleção de Dificuldade -->
    <div id="difficulty-selection" class="text-center fade-in">
      <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl p-6 sm:p-8 md:p-10 border border-blue-200 max-w-2xl mx-auto">
        <div class="mb-6 sm:mb-8">
          <div class="text-4xl sm:text-5xl mb-4">🥋</div>
          <h2 class="text-2xl sm:text-3xl font-bold text-gradient mb-3">Escolha o Nível de Dificuldade</h2>
          <p class="text-gray-600 text-sm sm:text-base">Selecione o nível que melhor se adequa ao seu conhecimento sobre judô</p>
        </div>
        
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 mb-6 sm:mb-8">
          <button onclick="selectDifficulty('easy')" 
                  class="difficulty-btn bg-green-50 hover:bg-green-100 border-2 border-green-200 hover:border-green-400 rounded-xl p-4 sm:p-6 transition-all duration-300 hover:scale-105 hover:shadow-lg">
            <div class="text-3xl sm:text-4xl mb-2">🟢</div>
            <h3 class="text-lg sm:text-xl font-bold text-green-700 mb-2">Fácil</h3>
            <p class="text-sm text-green-600">15 perguntas básicas</p>
          </button>
          
          <button onclick="selectDifficulty('medium')" 
                  class="difficulty-btn bg-yellow-50 hover:bg-yellow-100 border-2 border-yellow-200 hover:border-yellow-400 rounded-xl p-4 sm:p-6 transition-all duration-300 hover:scale-105 hover:shadow-lg">
            <div class="text-3xl sm:text-4xl mb-2">🟡</div>
            <h3 class="text-lg sm:text-xl font-bold text-yellow-700 mb-2">Médio</h3>
            <p class="text-sm text-yellow-600">15 perguntas intermediárias</p>
          </button>
          
          <button onclick="selectDifficulty('hard')" 
                  class="difficulty-btn bg-red-50 hover:bg-red-100 border-2 border-red-200 hover:border-red-400 rounded-xl p-4 sm:p-6 transition-all duration-300 hover:scale-105 hover:shadow-lg">
            <div class="text-3xl sm:text-4xl mb-2">🔴</div>
            <h3 class="text-lg sm:text-xl font-bold text-red-700 mb-2">Difícil</h3>
            <p class="text-sm text-red-600">15 perguntas avançadas</p>
          </button>
          
          <button onclick="selectDifficulty('all')" 
                  class="difficulty-btn bg-purple-50 hover:bg-purple-100 border-2 border-purple-200 hover:border-purple-400 rounded-xl p-4 sm:p-6 transition-all duration-300 hover:scale-105 hover:shadow-lg">
            <div class="text-3xl sm:text-4xl mb-2">🟣</div>
            <h3 class="text-lg sm:text-xl font-bold text-purple-700 mb-2">Todas</h3>
            <p class="text-sm text-purple-600">45 perguntas misturadas</p>
          </button>
        </div>
      </div>
    </div>

    <!-- Quiz Container -->
    <div id="quiz-container" class="space-y-6 hidden"></div>

    <!-- Finalização responsiva -->
    <div id="result" class="hidden text-center mt-8 sm:mt-12 fade-in">
      <div class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl p-4 sm:p-6 md:p-8 border border-blue-200">
        <div class="mb-4 sm:mb-6">
          <div class="text-4xl sm:text-5xl md:text-6xl mb-3 sm:mb-4">🎉</div>
          <h2 class="text-2xl sm:text-3xl font-bold text-gradient mb-2">Quiz Finalizado!</h2>
          <p class="text-gray-600 text-sm sm:text-base">Parabéns por completar o teste de teoria do judô!</p>
        </div>
        
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 mb-6 sm:mb-8">
          <div class="bg-blue-50 rounded-xl p-3 sm:p-4">
            <div class="text-xl sm:text-2xl font-bold text-blue-600" id="final-score">0/0</div>
            <div class="text-xs sm:text-sm text-blue-700">Acertos</div>
          </div>
          <div class="bg-purple-50 rounded-xl p-3 sm:p-4">
            <div class="text-xl sm:text-2xl font-bold text-purple-600" id="final-percentage">0%</div>
            <div class="text-xs sm:text-sm text-purple-700">Percentual</div>
          </div>
        </div>
        
        <!-- Mensagem de resultado -->
        <div class="text-center mb-6">
          <p class="text-lg font-semibold text-gray-700" id="result-message">
            🎉 Parabéns por completar o quiz!
          </p>
        </div>
        
        <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 justify-center">
          <button onclick="restartQuiz()" 
                  class="bg-gradient-to-r from-blue-600 to-blue-500 text-white px-6 sm:px-8 py-2 sm:py-3 rounded-xl hover:from-blue-700 hover:to-blue-600 transition-all duration-300 font-semibold flex items-center justify-center gap-2 text-sm sm:text-base">
            <i class="fa-solid fa-redo"></i>
            Reiniciar Quiz
          </button>
          <a href="/index/" 
             class="bg-gray-100 text-gray-700 px-6 sm:px-8 py-2 sm:py-3 rounded-xl hover:bg-gray-200 transition-all duration-300 font-semibold flex items-center justify-center gap-2 text-sm sm:text-base">
            <i class="fa-solid fa-arrow-left"></i>
            Voltar ao Início
          </a>
        </div>
      </div>
    </div>
  </main>

  <script>
    // Array original de perguntas classificadas por dificuldade
    const questionsByDifficulty = {
      easy: [
        {
          question: "Quem criou o judô?",
          answers: ["Jigoro Kano", "Mitsuyo Maeda", "Kyuzo Mifune", "Masahiko Kimura"],
          correct: 0,
          explanation: "Jigoro Kano criou o judô em 1882, fundando o Instituto Kodokan em Tóquio."
        },
        {
          question: "Qual é o significado da palavra 'judo'?",
          answers: ["Caminho da força", "Arte da guerra", "Caminho suave", "Arte marcial"],
          correct: 2,
          explanation: "'Ju' significa suave e 'do' significa caminho, formando 'caminho suave'."
        },
        {
          question: "Qual é o nome do uniforme usado no judô?",
          answers: ["Kimono", "Gi", "Judogi", "Hakama"],
          correct: 2,
          explanation: "Judogi é o nome correto do uniforme usado no judô."
        },
        {
          question: "Qual é o nome do local onde se pratica judô?",
          answers: ["Dojo", "Tatame", "Academia", "Ginásio"],
          correct: 0,
          explanation: "Dojo é o local sagrado onde se pratica judô e outras artes marciais."
        },
        {
          question: "O que significa 'Rei' no judô?",
          answers: ["Respeito", "Força", "Técnica", "Vitória"],
          correct: 0,
          explanation: "'Rei' significa respeito e é fundamental na etiqueta do judô."
        },
        {
          question: "Qual é a cor da faixa mais alta no judô?",
          answers: ["Vermelha", "Preta", "Branca", "Dourada"],
          correct: 0,
          explanation: "A faixa vermelha é a mais alta, seguida da branca e vermelha, e depois da preta."
        },
        {
          question: "Quantas faixas coloridas existem antes da faixa preta no judô?",
          answers: ["4", "5", "6", "8"],
          correct: 3,
          explanation: "Existem 8 faixas coloridas antes da faixa preta no judô."
        },
        {
          question: "O que significa 'Ukemi' no judô?",
          answers: ["Técnica de projeção", "Técnica de rolamentos", "Técnica de queda", "Técnica de estrangulamento"],
          correct: 1,
          explanation: "Ukemi são as técnicas de rolamentos que protegem o praticante durante as projeções."
        },
        {
          question: "Qual é o objetivo principal do judô?",
          answers: ["Derrotar o oponente", "Desenvolver corpo e mente", "Ganhar competições", "Aprender autodefesa"],
          correct: 1,
          explanation: "O judô visa o desenvolvimento físico, mental e moral através da prática."
        },
        {
          question: "Qual é a idade mínima para obter a faixa preta no judô?",
          answers: ["14 anos", "16 anos", "18 anos", "Não há idade mínima"],
          correct: 1,
          explanation: "A idade mínima para obter a faixa preta (1º dan) é 16 anos."
        },
        {
          question: "Em que ano o judô se tornou esporte olímpico?",
          answers: ["1964", "1972", "1980", "1988"],
          correct: 0,
          explanation: "O judô se tornou esporte olímpico em 1964, nos Jogos de Tóquio."
        },
        {
          question: "Qual é a duração de uma luta de judô em competição?",
          answers: ["3 minutos", "4 minutos", "5 minutos", "6 minutos"],
          correct: 1,
          explanation: "Uma luta de judô em competição dura 4 minutos para adultos."
        },
        {
          question: "O que significa 'Ippon' no judô?",
          answers: ["Ponto completo", "Ponto parcial", "Penalidade", "Empate"],
          correct: 0,
          explanation: "Ippon é o ponto completo que encerra imediatamente a luta."
        },
        {
          question: "O que significa 'Waza-ari' no judô?",
          answers: ["Ponto completo", "Ponto parcial", "Penalidade", "Aviso"],
          correct: 1,
          explanation: "Waza-ari é um ponto parcial, dois waza-ari equivalem a um ippon."
        },
        {
          question: "O que significa 'Shido' no judô?",
          answers: ["Ponto", "Penalidade leve", "Penalidade grave", "Desqualificação"],
          correct: 1,
          explanation: "Shido é uma penalidade leve por infrações menores durante a luta."
        }
      ],
      medium: [
        {
          question: "Qual é o princípio fundamental do judô?",
          answers: ["Máxima eficiência com mínimo esforço", "Força bruta", "Velocidade máxima", "Técnica perfeita"],
          correct: 0,
          explanation: "O princípio fundamental é 'Seiryoku Zenyo' - máxima eficiência com mínimo esforço."
        },
        {
          question: "Qual é uma das técnicas mais fundamentais do judô?",
          answers: ["Uke-goshi", "Seoi-nage", "O-goshi", "Tai-otoshi"],
          correct: 2,
          explanation: "Seoi-nage é uma das primeiras técnicas ensinadas no judô, sendo fundamental para o aprendizado."
        },
        {
          question: "O que significa 'Kata' no judô?",
          answers: ["Luta livre", "Forma ou padrão", "Competição", "Treino físico"],
          correct: 1,
          explanation: "Kata são sequências formais de técnicas executadas em padrões específicos."
        },
        {
          question: "Qual é o nome da técnica de imobilização mais básica?",
          answers: ["Kesa-gatame", "Kami-shiho-gatame", "Yoko-shiho-gatame", "Tate-shiho-gatame"],
          correct: 0,
          explanation: "Kesa-gatame (imobilização em diagonal) é considerada a mais básica das imobilizações."
        },
        {
          question: "O que significa 'Randori' no judô?",
          answers: ["Treino livre", "Competição", "Kata", "Aquecimento"],
          correct: 0,
          explanation: "Randori é o treino livre onde os praticantes aplicam técnicas sem resistência excessiva."
        },
        {
          question: "Qual é o nome da técnica de projeção com quadril?",
          answers: ["Seoi-nage", "Tai-otoshi", "O-goshi", "O-soto-gari"],
          correct: 2,
          explanation: "O-goshi é uma técnica de projeção que utiliza o quadril como ponto de apoio principal."
        },
        {
          question: "Qual é o nome da técnica de projeção com perna?",
          answers: ["O-goshi", "Seoi-nage", "O-soto-gari", "Tai-otoshi"],
          correct: 2,
          explanation: "O-soto-gari é uma técnica de projeção que utiliza a perna para derrubar o oponente."
        },
        {
          question: "Qual é o nome da técnica de projeção com biceps?",
          answers: ["O-goshi", "Seoi-nage", "Uke-goshi", "Tai-otoshi"],
          correct: 1,
          explanation: "Seoi-nage é uma técnica de projeção que utiliza o ombro como ponto de apoio."
        },
        {
          question: "Qual é o nome da técnica de projeção com corpo?",
          answers: ["O-goshi", "Seoi-nage", "Tai-otoshi", "Uke-goshi"],
          correct: 2,
          explanation: "Tai-otoshi é uma técnica de projeção que utiliza o corpo como alavanca."
        },
        {
          question: "O que significa 'Osae-komi' no judô?",
          answers: ["Imobilização", "Projeção", "Estrangulamento", "Chave de braço"],
          correct: 0,
          explanation: "Osae-komi é o anúncio de que uma imobilização está sendo aplicada."
        },
        {
          question: "O que significa 'Toketa' no judô?",
          answers: ["Imobilização", "Imobilização quebrada", "Projeção", "Estrangulamento"],
          correct: 1,
          explanation: "Toketa é o anúncio de que uma imobilização foi quebrada pelo oponente."
        },
        {
          question: "O que significa 'Sonomama' no judô?",
          answers: ["Interrupção temporária", "Continue", "Lute", "Descanso"],
          correct: 0,
          explanation: "Sonomama é o comando para parar a luta temporariamente e manter a posição atual."
        },
        {
          question: "O que significa 'Yoshi' no judô?",
          answers: ["Pare", "Interrupção de luta", "Lute", "Descanso"],
          correct: 1,
          explanation: "Yoshi é o comando para interromper a luta temporariamente."
        },
        {
          question: "O que significa 'Mate' no judô?",
          answers: ["Continue", "Pare", "Lute", "Descanso"],
          correct: 1,
          explanation: "Mate é o comando para parar a luta temporariamente."
        },
        {
          question: "O que significa 'Hajime' no judô?",
          answers: ["Pare", "Continue", "Comece", "Descanso"],
          correct: 2,
          explanation: "Hajime é o comando para começar a luta."
        },
        {
          question: "Quem introduziu o judô no Brasil?",
          answers: ["Jigoro Kano", "Mitsuyo Maeda", "Carlos Gracie", "Helio Gracie"],
          correct: 1,
          explanation: "Mitsuyo Maeda, conhecido como 'Conde Koma', introduziu o judô no Brasil em 1914."
        },
        {
          question: "Em que cidade do Brasil o judô foi primeiro ensinado?",
          answers: ["São Paulo", "Rio de Janeiro", "Belém do Pará", "Brasília"],
          correct: 2,
          explanation: "Mitsuyo Maeda estabeleceu-se em Belém do Pará, onde fundou a primeira escola de judô do país."
        },
        {
          question: "Qual família brasileira foi influenciada pelo judô de Maeda?",
          answers: ["Família Gracie", "Família Machado", "Família Vieira", "Família Santos"],
          correct: 0,
          explanation: "A família Gracie foi uma das principais influenciadas pelo judô de Mitsuyo Maeda, contribuindo para o desenvolvimento do Jiu-Jitsu brasileiro."
        }
      ],
      hard: [
        {
          question: "Qual é o nome da técnica de estrangulamento mais conhecida?",
          answers: ["Hadaka-jime", "Okuri-eri-jime", "Kata-juji-jime", "Sankaku-jime"],
          correct: 0,
          explanation: "Hadaka-jime (estrangulamento nu) é uma das técnicas de estrangulamento mais fundamentais."
        },
        {
          question: "Qual é o nome da técnica de estrangulamento com gola?",
          answers: ["Hadaka-jime", "Okuri-eri-jime", "Kata-juji-jime", "Sankaku-jime"],
          correct: 1,
          explanation: "Okuri-eri-jime é uma técnica de estrangulamento que utiliza a gola do judogi."
        },
        {
          question: "Qual é o nome da técnica de estrangulamento com cruz?",
          answers: ["Hadaka-jime", "Okuri-eri-jime", "Kata-juji-jime", "Sankaku-jime"],
          correct: 2,
          explanation: "Kata-juji-jime é uma técnica de estrangulamento que utiliza os braços em formato de cruz."
        },
        {
          question: "Qual é o nome da técnica de estrangulamento com triângulo?",
          answers: ["Hadaka-jime", "Okuri-eri-jime", "Kata-juji-jime", "Sankaku-jime"],
          correct: 3,
          explanation: "Sankaku-jime é uma técnica de estrangulamento que utiliza as pernas em formato de triângulo."
        },
        {
          question: "Qual é o nome da técnica de projeção com sacrifício?",
          answers: ["Tomoe-nage", "Seoi-nage", "O-goshi", "Tai-otoshi"],
          correct: 0,
          explanation: "Tomoe-nage é uma técnica de projeção com sacrifício onde o atacante se joga ao chão."
        },
        {
          question: "Qual é o nome da técnica de projeção com joelho?",
          answers: ["Hiza-guruma", "Seoi-nage", "O-goshi", "Tai-otoshi"],
          correct: 0,
          explanation: "Hiza-guruma é uma técnica de projeção que utiliza o joelho como ponto de apoio."
        },
        {
          question: "Qual é o nome da técnica de projeção com tornozelo?",
          answers: ["Ashi-guruma", "Seoi-nage", "O-goshi", "Tai-otoshi"],
          correct: 0,
          explanation: "Ashi-guruma é uma técnica de projeção que utiliza o tornozelo como ponto de apoio."
        },
        {
          question: "O que significa 'Hansoku-make' no judô?",
          answers: ["Ponto completo", "Penalidade leve", "Penalidade grave", "Desqualificação"],
          correct: 3,
          explanation: "Hansoku-make é a desqualificação por infrações graves ou acumulação de penalidades."
        },
        {
          question: "O que significa 'Sore-made' no judô?",
          answers: ["Continue", "Pare", "Lute", "Fim da luta"],
          correct: 3,
          explanation: "Sore-made é o comando que indica o fim da luta."
        },
        {
          question: "Qual é o nome da técnica de imobilização lateral de quatro pontos?",
          answers: ["Kesa-gatame", "Kami-shiho-gatame", "Yoko-shiho-gatame", "Tate-shiho-gatame"],
          correct: 2,
          explanation: "Yoko-shiho-gatame é uma imobilização lateral que utiliza quatro pontos de contato."
        },
        {
          question: "Qual é o nome da técnica de imobilização superior de quatro pontos?",
          answers: ["Kesa-gatame", "Kami-shiho-gatame", "Yoko-shiho-gatame", "Tate-shiho-gatame"],
          correct: 1,
          explanation: "Kami-shiho-gatame é uma imobilização superior que utiliza quatro pontos de contato."
        },
        {
          question: "Qual é o nome da técnica de imobilização vertical de quatro pontos?",
          answers: ["Kesa-gatame", "Kami-shiho-gatame", "Yoko-shiho-gatame", "Tate-shiho-gatame"],
          correct: 3,
          explanation: "Tate-shiho-gatame é uma imobilização vertical que utiliza quatro pontos de contato."
        },
        {
          question: "Qual é o nome da técnica de projeção com quadril em diagonal?",
          answers: ["Koshi-guruma", "Seoi-nage", "O-goshi", "Tai-otoshi"],
          correct: 0,
          explanation: "Koshi-guruma é uma técnica de projeção que utiliza o quadril em movimento diagonal."
        },
        {
          question: "Qual é o nome da técnica de projeção com quadril em grande movimento?",
          answers: ["O-goshi", "Koshi-guruma", "Uke-goshi", "Tai-otoshi"],
          correct: 0,
          explanation: "O-goshi é uma técnica de projeção que utiliza o quadril em grande movimento circular."
        },
        {
          question: "Qual é o nome da técnica de projeção com quadril em movimento de apoio?",
          answers: ["O-goshi", "Koshi-guruma", "Uke-goshi", "Tai-otoshi"],
          correct: 2,
          explanation: "Uke-goshi é uma técnica de projeção que utiliza o quadril como ponto de apoio estático."
        }
      ]
    };

    // Variáveis globais
    let questions = [];
    let currentQuestion = 0;
    let currentDifficulty = null; // Dificuldade atual do quiz
    let score = 0;
    let answered = false;
    let selectedDifficulty = '';

    // Função para randomizar array (Fisher-Yates shuffle)
    function shuffleArray(array) {
      const shuffled = [...array];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }
    
    // Função para selecionar dificuldade
    function selectDifficulty(difficulty) {
      selectedDifficulty = difficulty;
      currentDifficulty = difficulty; // Definir a dificuldade atual
      
      console.log('🎯 Selecionando dificuldade:', difficulty);
      
      // Limpar cache das perguntas para forçar recarregamento
      localStorage.removeItem(`quiz_questions_${difficulty}`);
      console.log('🗑️ Cache de perguntas limpo para dificuldade:', difficulty);
      
      // Carregar perguntas SEM randomização (para manter progresso)
      loadQuestionsWithoutRandom(difficulty);
      
      // Esconder seleção de dificuldade e mostrar quiz
      document.getElementById('difficulty-selection').classList.add('hidden');
      document.getElementById('quiz-container').classList.remove('hidden');
      
      // Carregar progresso salvo antes de inicializar
      loadQuizProgress().then(() => {
        // Inicializar quiz após carregar progresso
        initQuiz();
      }).catch(error => {
        console.log('❌ Erro ao carregar progresso:', error);
        // Inicializar quiz mesmo com erro
        initQuiz();
      });
    }
    
    // Função para carregar perguntas COM randomização (novo quiz)
    function loadQuestionsWithRandom(difficulty) {
      if (difficulty === 'all') {
        // Para "Todas as Perguntas", misturar todas as perguntas de todos os níveis
        const allEasyQuestions = questionsByDifficulty.easy;
        const allMediumQuestions = questionsByDifficulty.medium;
        const allHardQuestions = questionsByDifficulty.hard;
        
        // Combinar todas as perguntas
        const combinedQuestions = [...allEasyQuestions, ...allMediumQuestions, ...allHardQuestions];
        
        // Selecionar 45 perguntas misturadas (ou todas se houver menos de 45)
        questions = shuffleArray(combinedQuestions).slice(0, 45);
      } else {
        // Selecionar 15 perguntas da dificuldade escolhida
        const allQuestions = questionsByDifficulty[difficulty];
        questions = shuffleArray(allQuestions).slice(0, 15);
      }
      
      // Randomizar alternativas de cada pergunta
      randomizeQuestionAnswers();
      
      // Salvar a ordem das perguntas no localStorage para manter consistência
      localStorage.setItem(`quiz_questions_${difficulty}`, JSON.stringify(questions));
    }
    
    // Função para carregar perguntas SEM randomização (quiz com progresso)
    function loadQuestionsWithoutRandom(difficulty) {
      // Tentar carregar perguntas salvas do localStorage
      const savedQuestions = localStorage.getItem(`quiz_questions_${difficulty}`);
      
      if (savedQuestions) {
        questions = JSON.parse(savedQuestions);
        console.log('✅ Perguntas carregadas do localStorage (ordem mantida)');
      } else {
        // Se não tem perguntas salvas, carregar diretamente sem randomizar
        console.log('⚠️ Perguntas não encontradas no localStorage, carregando diretamente...');
        
        if (difficulty === 'all') {
          // Para "Todas as Perguntas", misturar todas as perguntas de todos os níveis
          const allEasyQuestions = questionsByDifficulty.easy;
          const allMediumQuestions = questionsByDifficulty.medium;
          const allHardQuestions = questionsByDifficulty.hard;
          
          // Combinar todas as perguntas
          const combinedQuestions = [...allEasyQuestions, ...allMediumQuestions, ...allHardQuestions];
          
          // Selecionar 45 perguntas (ou todas se houver menos de 45)
          questions = combinedQuestions.slice(0, 45);
        } else {
          // Selecionar 15 perguntas da dificuldade escolhida (SEM randomizar)
          const allQuestions = questionsByDifficulty[difficulty];
          questions = allQuestions.slice(0, 15);
        }
        
        // Salvar as perguntas no localStorage para manter consistência
        localStorage.setItem(`quiz_questions_${difficulty}`, JSON.stringify(questions));
        console.log('💾 Perguntas salvas no localStorage para consistência');
      }
      
      // Garantir que sempre temos 15 perguntas (exceto para 'all')
      if (difficulty !== 'all' && questions.length > 15) {
        questions = questions.slice(0, 15);
        console.log('📝 Limitando a 15 perguntas por modo');
      }
    }
    
    // Função para randomizar apenas as alternativas das perguntas
    function randomizeQuestionAnswers() {
      questions.forEach((question, questionIndex) => {
        const originalAnswers = [...question.answers];
        const correctAnswer = originalAnswers[question.correct];
        
        // Randomizar as alternativas
        const shuffledAnswers = shuffleArray(originalAnswers);
        
        // Encontrar a nova posição da resposta correta
        const newCorrectIndex = shuffledAnswers.indexOf(correctAnswer);
        
        // Atualizar a pergunta
        questions[questionIndex] = {
          ...question,
          answers: shuffledAnswers,
          correct: newCorrectIndex
        };
      });
    }

    const quizContainer = document.getElementById("quiz-container");
    const statusElement = document.getElementById("status");
    const scoreElement = document.getElementById("score");
    const progressBar = document.getElementById("progressBar");
    const resultElement = document.getElementById("result");
    const finalScoreElement = document.getElementById("final-score");
    const finalPercentageElement = document.getElementById("final-percentage");

    function updateStatus() {
      console.log('📊 Atualizando status...');
      console.log('   Pergunta atual:', currentQuestion);
      console.log('   Score:', score);
      console.log('   Total perguntas:', questions.length);
      
      statusElement.innerHTML = `<i class="fa-solid fa-question-circle mr-2"></i>Pergunta ${currentQuestion + 1}/${questions.length}`;
      scoreElement.innerHTML = `<i class="fa-solid fa-trophy mr-2"></i>Acertos: ${score}`;
      
      // Calcular progresso baseado na pergunta atual (começando em 0%)
      const progress = (currentQuestion / questions.length) * 100;
      progressBar.style.width = `${progress}%`;
      
      // Salvar progresso no banco de dados
      saveQuizProgress();
      
      console.log('   Progresso calculado:', progress + '%');
      console.log('   Barra de progresso atualizada para:', progressBar.style.width);
      console.log('   Status atualizado com sucesso');
    }

    function createQuestionCard() {
      const q = questions[currentQuestion];
      
      // Log do progresso atual
      const progress = (currentQuestion / questions.length) * 100;
      console.log(`📊 Criando pergunta ${currentQuestion + 1}/${questions.length} - Progresso: ${progress.toFixed(1)}%`);
      
      const card = document.createElement("div");
      card.className = "bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl p-4 sm:p-6 md:p-8 border border-blue-200 fade-in";
      card.style.maxWidth = "800px";
      card.style.margin = "0 auto";

      const questionHeader = document.createElement("div");
      questionHeader.className = "text-center mb-6 sm:mb-8";
      
      const questionNumber = document.createElement("div");
      questionNumber.className = "text-xs sm:text-sm text-blue-600 font-semibold mb-2";
      questionNumber.textContent = `Pergunta ${currentQuestion + 1} de ${questions.length}`;
      
      const questionText = document.createElement("h2");
      questionText.className = "text-lg sm:text-xl md:text-2xl font-bold text-gray-800 mb-3 sm:mb-4";
      questionText.textContent = q.question;
      
      questionHeader.appendChild(questionNumber);
      questionHeader.appendChild(questionText);
      card.appendChild(questionHeader);

      const answersDiv = document.createElement("div");
      answersDiv.className = "grid gap-3 sm:gap-4";

      q.answers.forEach((answer, index) => {
        const btn = document.createElement("button");
        btn.textContent = answer;
        btn.className = "answer-btn bg-white text-gray-800 py-3 sm:py-4 px-4 sm:px-6 rounded-xl border-2 border-gray-200 hover:border-blue-300 hover:bg-gray-50 transition-all duration-300 text-left font-medium text-sm sm:text-base";
        btn.onclick = () => handleAnswer(index, btn, answersDiv);
        answersDiv.appendChild(btn);
      });

      card.appendChild(answersDiv);
      
      // Adicionar explicação (inicialmente oculta)
      const explanationDiv = document.createElement("div");
      explanationDiv.className = "mt-4 sm:mt-6 p-3 sm:p-4 bg-blue-50 rounded-xl border border-blue-200 hidden";
      explanationDiv.id = "explanation";
      
      const explanationTitle = document.createElement("div");
      explanationTitle.className = "font-semibold text-blue-800 mb-2 text-sm sm:text-base";
      explanationTitle.innerHTML = '<i class="fa-solid fa-lightbulb mr-1 sm:mr-2"></i>Explicação:';
      
      const explanationText = document.createElement("p");
      explanationText.className = "text-blue-700 text-xs sm:text-sm";
      explanationText.textContent = q.explanation;
      
      explanationDiv.appendChild(explanationTitle);
      explanationDiv.appendChild(explanationText);
      card.appendChild(explanationDiv);

      // Botão "Próxima Pergunta" (inicialmente oculto)
      const nextButtonDiv = document.createElement("div");
      nextButtonDiv.className = "mt-6 text-center hidden";
      nextButtonDiv.id = "next-button-container";
      
      const nextButton = document.createElement("button");
      nextButton.className = "bg-gradient-to-r from-blue-600 to-blue-500 text-white px-8 py-3 rounded-xl hover:from-blue-700 hover:to-blue-600 transition-all duration-300 font-semibold flex items-center justify-center gap-2 mx-auto";
      nextButton.innerHTML = '<i class="fa-solid fa-arrow-right mr-2"></i>Próxima Pergunta';
      nextButton.onclick = () => nextQuestion();
      
      nextButtonDiv.appendChild(nextButton);
      card.appendChild(nextButtonDiv);

      quizContainer.appendChild(card);
    }

    function handleAnswer(selectedIndex, btn, answersDiv) {
      if (answered) return; // Evitar múltiplos cliques
      
      const correctIndex = questions[currentQuestion].correct;
      const buttons = answersDiv.querySelectorAll("button");
      const explanation = document.getElementById("explanation");

      // Desabilitar todos os botões
      buttons.forEach(b => b.disabled = true);

      if (selectedIndex === correctIndex) {
        // Resposta correta - mostrar verde
        btn.classList.add("answer-correct");
        score++;
        
        // Mostrar explicação
        if (explanation) {
          setTimeout(() => {
            explanation.classList.remove("hidden");
            explanation.classList.add("slide-in");
          }, 500);
        }
        
        // Avançar automaticamente para próxima pergunta após 2 segundos
        setTimeout(() => {
          nextQuestion();
        }, 2000);
        
      } else {
        // Resposta incorreta - mostrar vermelho na resposta errada e verde na correta
        btn.classList.add("answer-incorrect");
        buttons[correctIndex].classList.add("answer-show-correct");
        
        // Mostrar explicação
        if (explanation) {
          setTimeout(() => {
            explanation.classList.remove("hidden");
            explanation.classList.add("slide-in");
          }, 500);
        }
        
        // Avançar automaticamente para próxima pergunta após 3 segundos
        setTimeout(() => {
          nextQuestion();
        }, 3000);
      }

      answered = true;
      updateStatus();
      
      // Salvar progresso imediatamente após responder
      console.log('💾 Salvando progresso após resposta...');
      saveQuizProgress();
    }

    function nextQuestion() {
      currentQuestion++;
      answered = false;
      
      if (currentQuestion < questions.length) {
        quizContainer.innerHTML = "";
        createQuestionCard();
      } else {
        showResult();
      }
    }

    function showResult() {
      const percentage = Math.round((score / questions.length) * 100);
      
      finalScoreElement.textContent = `${score}/${questions.length}`;
      finalPercentageElement.textContent = `${percentage}%`;
      
      // Adicionar mensagem personalizada baseada na performance
      let message = '';
      let emoji = '';
      
      if (percentage >= 90) {
        message = 'Excelente! Você é um verdadeiro mestre do judô!';
        emoji = '🥇';
      } else if (percentage >= 70) {
        message = 'Muito bom! Você tem um ótimo conhecimento!';
        emoji = '🥈';
      } else if (percentage >= 50) {
        message = 'Bom trabalho! Continue praticando!';
        emoji = '🥉';
      } else {
        message = 'Não desista! A prática leva à perfeição!';
        emoji = '💪';
      }
      
      // Atualizar mensagem no modal
      const messageElement = document.getElementById('result-message');
      if (messageElement) {
        messageElement.innerHTML = `${emoji} ${message}`;
      }
      
      resultElement.classList.remove("hidden");
      resultElement.classList.add("bounce-in");
      
      // Centralizar o modal na tela
      resultElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
      
      // Garantir que a barra de progresso chegue a 100%
      progressBar.style.width = '100%';
      
      // Marcar quiz como completo e salvar progresso final
      console.log('🎉 Quiz completado! Marcando como completo...');
      saveQuizProgress();
      
      // Após 3 segundos, reiniciar automaticamente o quiz
      setTimeout(() => {
        console.log('🔄 Reiniciando quiz automaticamente...');
        restartQuiz();
      }, 3000);
    }

    function restartQuiz() {
      currentQuestion = 0;
      score = 0;
      answered = false;
      quizContainer.innerHTML = "";
      resultElement.classList.add("hidden");
      
      // Voltar para seleção de dificuldade
      document.getElementById('difficulty-selection').classList.remove('hidden');
      document.getElementById('quiz-container').classList.add('hidden');
      
      // Resetar barra de progresso
      progressBar.style.width = '0%';
      console.log('🔄 Quiz reiniciado - barra de progresso resetada para 0%');
      
      // Resetar progresso no backend se há uma dificuldade selecionada
      if (currentDifficulty) {
        console.log('🔄 Resetando progresso no backend...');
        resetQuizProgress();
      }
    }

    function initQuiz() {
      console.log('🎯 Inicializando quiz...');
      console.log('   Pergunta atual:', currentQuestion);
      console.log('   Score:', score);
      console.log('   Total perguntas:', questions.length);
      
      // Sempre atualizar status primeiro
      updateStatus();
      
      // Se há perguntas e não completou, criar pergunta
      if (questions.length > 0 && currentQuestion < questions.length) {
        createQuestionCard();
      } else {
        console.log('⚠️ Nenhuma pergunta disponível ou quiz já completado');
      }
    }

    // Inicializar apenas a tela de seleção quando a página carregar
    document.addEventListener('DOMContentLoaded', function() {
      // Mostrar apenas a seleção de dificuldade inicialmente
      document.getElementById('difficulty-selection').classList.remove('hidden');
      document.getElementById('quiz-container').classList.add('hidden');
      document.getElementById('result').classList.add('hidden');
    });

    // ===== SISTEMA DE PROGRESSO LIBERADO - TODOS OS NÍVEIS DISPONÍVEIS =====
    
    // Todos os níveis estão liberados - sem verificação de bloqueio
    
    // Salvar progresso do quiz no banco de dados
    function saveQuizProgress() {
      console.log('🔄 Salvando progresso do quiz...');
      console.log('   Dificuldade:', currentDifficulty);
      console.log('   Pergunta atual:', currentQuestion);
      console.log('   Total perguntas:', questions.length);
      console.log('   Acertos:', score);
      
      // Verificar se temos dados válidos
      if (!currentDifficulty) {
        console.log('❌ Nenhuma dificuldade selecionada, não salvando progresso');
        return;
      }
      
      const progressData = {
        dificuldade: currentDifficulty,
        pergunta_atual: currentQuestion,
        total_perguntas: questions.length,
        acertos: score,
        erros: currentQuestion - score,
        pontuacao: score * 10, // 10 pontos por acerto
        quiz_completo: currentQuestion >= questions.length
      };
      
      console.log('📤 Enviando dados:', progressData);
      
      // Verificar CSRF token
      const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]');
      if (!csrfToken) {
        console.error('❌ CSRF token não encontrado!');
        return;
      }
      console.log('🔐 CSRF token encontrado:', csrfToken.value.substring(0, 10) + '...');
      
      fetch('/quiz/salvar-progresso/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify(progressData)
      })
      .then(response => {
        console.log('📥 Resposta recebida:', response.status);
        return response.json();
      })
      .then(data => {
        console.log('📊 Dados recebidos:', data);
        if (data.success) {
          console.log('✅ Progresso do quiz salvo:', data.message);
          
          // Quiz completado com sucesso
          if (progressData.quiz_completo) {
            console.log('🎉 Quiz completado com sucesso!');
          }
        } else {
          console.error('❌ Erro ao salvar progresso do quiz:', data.error);
        }
      })
      .catch(error => {
        console.error('❌ Erro de conexão ao salvar progresso do quiz:', error);
      });
    }
    
    // Carregar progresso do quiz do banco de dados
    function loadQuizProgress() {
      return new Promise((resolve, reject) => {
        if (!currentDifficulty) {
          console.log('❌ Nenhuma dificuldade selecionada para carregar progresso');
          resolve();
          return;
        }
        
        console.log('🔄 Carregando progresso do quiz...');
        console.log('   Dificuldade:', currentDifficulty);
        console.log('   Perguntas carregadas:', questions.length);
        
        fetch(`/quiz/carregar-progresso/?dificuldade=${currentDifficulty}`)
        .then(response => {
          console.log('📥 Resposta de carregamento:', response.status);
          return response.json();
        })
        .then(data => {
          console.log('📊 Dados de progresso recebidos:', data);
          
          if (data.success && data.progresso) {
            console.log('✅ Carregando progresso do quiz:', data.progresso);
            
            // Se o quiz foi completado, reiniciar do zero
            if (data.progresso.quiz_completo) {
              console.log('🎉 Quiz já foi completado! Reiniciando do zero...');
              currentQuestion = 0;
              score = 0;
              answered = false;
              
              // Limpar progresso salvo e reiniciar no backend
              resetQuizProgress();
            } else {
              // Restaurar estado do quiz se não foi completado
              currentQuestion = data.progresso.pergunta_atual;
              score = data.progresso.acertos;
              
              console.log('   Pergunta atual restaurada:', currentQuestion);
              console.log('   Score restaurado:', score);
              
              // Se o quiz não foi completado, continuar de onde parou
              if (currentQuestion < questions.length) {
                console.log(`🎯 Continuando quiz da pergunta ${currentQuestion + 1}`);
                // Atualizar status após carregar progresso
                updateStatus();
              }
            }
          } else {
            console.log('ℹ️ Nenhum progresso salvo para esta dificuldade');
          }
          
          resolve();
        })
        .catch(error => {
          console.error('❌ Erro ao carregar progresso do quiz:', error);
          reject(error);
        });
      });
    }
    
    // Função para resetar o progresso do quiz no backend
    function resetQuizProgress() {
      console.log('🔄 Resetando progresso do quiz no backend...');
      
      const resetData = {
        dificuldade: currentDifficulty,
        pergunta_atual: 0,
        total_perguntas: questions.length,
        acertos: 0,
        erros: 0,
        pontuacao: 0,
        quiz_completo: false
      };
      
      console.log('📤 Enviando dados de reset:', resetData);
      
      // Verificar CSRF token
      const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]');
      if (!csrfToken) {
        console.error('❌ CSRF token não encontrado!');
        return;
      }
      
      fetch('/quiz/salvar-progresso/', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
        },
        body: JSON.stringify(resetData)
      })
      .then(response => {
        console.log('📥 Resposta de reset recebida:', response.status);
        return response.json();
      })
      .then(data => {
        console.log('📊 Dados de reset recebidos:', data);
        if (data.success) {
          console.log('✅ Progresso do quiz resetado com sucesso!');
        } else {
          console.error('❌ Erro ao resetar progresso do quiz:', data.error);
        }
      })
      .catch(error => {
        console.error('❌ Erro de conexão ao resetar progresso do quiz:', error);
      });
    }
    
    // Modificar a função nextQuestion para salvar progresso
    const originalNextQuestion = nextQuestion;
    nextQuestion = function() {
      originalNextQuestion();
      updateStatus(); // Atualizar barra de progresso
      saveQuizProgress(); // Salvar progresso após cada pergunta
    };
    
    // Modificar a função selectDifficulty para carregar progresso
    const originalSelectDifficulty = selectDifficulty;
    selectDifficulty = function(difficulty) {
      console.log('🎯 Iniciando selectDifficulty para:', difficulty);
      
      // Primeiro carregar o progresso, depois inicializar o quiz
      loadQuizProgress().then(() => {
        console.log('✅ Progresso carregado, inicializando quiz...');
        originalSelectDifficulty(difficulty);
      }).catch(error => {
        console.error('❌ Erro ao carregar progresso, continuando sem progresso:', error);
        originalSelectDifficulty(difficulty);
      });
    };
    
    // Todos os níveis estão liberados - sem verificação necessária
  </script>
</body>
</html>
