<!DOCTYPE html>
<html lang="pt-BR">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Email Marketing - Dashboard</title>
	<script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
	<header class="bg-gradient-to-r from-indigo-600 to-blue-600 text-white p-4 shadow">
		<div class="max-w-6xl mx-auto flex items-center justify-between">
			<h1 class="text-lg sm:text-2xl font-bold">✉️ Email Marketing</h1>
			<a href="{% url 'dashboard_admin' %}" class="px-3 py-2 bg-white/15 hover:bg-white/25 rounded-lg text-sm">← Voltar ao Dashboard</a>
		</div>
	</header>

	<div class="max-w-6xl mx-auto p-4 sm:p-6">
		{% if messages %}
		<div class="space-y-2 mb-4">
			{% for m in messages %}
			<div class="p-3 rounded-lg text-sm {% if m.tags == 'success' %}bg-emerald-50 text-emerald-800 border border-emerald-200{% elif m.tags == 'error' %}bg-red-50 text-red-800 border border-red-200{% else %}bg-blue-50 text-blue-800 border border-blue-200{% endif %}">
				{{ m }}
			</div>
			{% endfor %}
		</div>
		{% endif %}

		<form method="post" class="bg-white rounded-2xl shadow p-4 sm:p-6">
			{% csrf_token %}

			<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
				<!-- Campos do email -->
				<div class="lg:col-span-2 space-y-4">
					<div>
						<label class="block text-sm font-medium text-gray-700 mb-1">Assunto</label>
						<input name="subject" type="text" class="w-full rounded-lg border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="Ex.: Aproveite 15% de desconto neste mês" value="{{ default_subject }}" required>
					</div>
					<div>
						<label class="block text-sm font-medium text-gray-700 mb-1">Mensagem</label>
						<textarea name="body" rows="12" class="w-full rounded-lg border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="Escreva sua mensagem de remarketing aqui..." required>{{ default_body }}</textarea>
						<p class="text-xs text-gray-500 mt-1">Dica: Mantenha curto e claro. Sua identidade de remetente é definida por DEFAULT_FROM_EMAIL.</p>
					</div>
				</div>

				<!-- Seleção de destinatários -->
				<div class="space-y-4">
					<div class="bg-gray-50 rounded-xl p-4 border border-gray-200">
						<label class="block text-sm font-medium text-gray-700 mb-2">Destinatários</label>
						<div class="space-y-2">
							<label class="flex items-center gap-2 text-sm">
								<input type="radio" name="send_to" value="selected" class="text-blue-600" checked>
								<span>Selecionar usuários</span>
							</label>
							<label class="flex items-center gap-2 text-sm">
								<input type="radio" name="send_to" value="all" class="text-blue-600">
								<span>Todos os usuários grátis (ativos)</span>
							</label>
							<p class="text-xs text-gray-500 mt-1">Exibindo apenas contas no plano grátis (sem assinatura ativa).</p>
						</div>
					</div>

					<div class="bg-white rounded-xl border border-gray-200 h-80 overflow-y-auto p-3">
						<div class="sticky top-0 bg-white pb-2">
							<input id="searchUser" type="text" class="w-full rounded-lg border-gray-300 focus:ring-blue-500 focus:border-blue-500" placeholder="Pesquisar email ou username...">
						</div>
						<ul id="userList" class="space-y-2">
							{% for u in users %}
							<li class="flex items-center gap-2 text-sm user-item" data-q="{{ u.username }} {{ u.email }}">
								<input type="checkbox" name="user_ids" value="{{ u.id }}" class="text-blue-600">
								<span class="font-medium">{{ u.username }}</span>
								<span class="text-gray-500 truncate">• {{ u.email }}</span>
							</li>
							{% endfor %}
						</ul>
					</div>
				</div>
			</div>

			<div class="mt-6 flex items-center justify-end gap-3">
				<button type="submit" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-medium">Enviar</button>
			</div>
		</form>
	</div>

	<script>
		// filtro simples de usuários
		(function(){
			const input = document.getElementById('searchUser');
			const items = document.querySelectorAll('.user-item');
			if (!input) return;
			input.addEventListener('input', function(){
				const q = (this.value || '').toLowerCase();
				items.forEach(li => {
					const hay = (li.getAttribute('data-q') || '').toLowerCase();
					li.style.display = hay.includes(q) ? '' : 'none';
				});
			});
		})();
	</script>
</body>
</html>

